---
title: "Plotting"
author: "Yiqian Xin"
date: "3/24/2022"
output: html_document
---

# Preparation

```{r import packages}
library(tidyverse)
library(ggplot2)
```

```{r Import data}
baseline <- read_csv(file = "../data/baseline.csv")
head(baseline)
```


## Figure 4&6
```{r}
# Prepare
baseline$alc <- baseline$alc_freq
baseline$alc[baseline$alc_consumption == 0] <- 0
baseline$alc <- factor(baseline$alc,
                       labels = c("Never", "Less than once per month", 
                                  "1-3 days per month", "1-4 days per week",
                                  "5-6 days per week", "Daily"))
baseline$sex_risk <- factor(baseline$sex_risk,
                            labels = c("Had no risk sexual behavior",
                                       "Had risk sexual behavior"))
baseline$sex_hiv <- factor(baseline$sex_hiv,
                            labels = c("HIV-",
                                       "HIV+"))
baseline$sex <- factor(baseline$sex,
                       labels = c("Male", "Female"))
```

```{r}
# Figure 4
baseline %>%
  filter(is.na(alc) == FALSE, is.na(sex_risk) == FALSE) %>%
  group_by(alc, sex_risk) %>%
  summarize(count = n()) %>%
  mutate(proportion = round(count / sum(count) * 100, 2)) %>%
  ggplot(aes(x = factor(alc, levels = rev(levels(alc))), 
             y = proportion, fill = sex_risk)) +
  geom_col() +
  geom_text(aes(label = proportion), 
            position = position_stack(vjust = 0.5),
            color = "white") +
  coord_flip() +
  labs(title = "The percentage of risk sexual behavior signigicantly \nincreases if drink alcohol more than one days per month.",
       x = "Frequency of alcohol consumption",
       y = "% of risk sexual behavior") +
  theme_minimal() +
  theme(legend.title=element_blank(),
        legend.position = "bottom",
        plot.title = element_text(hjust = 1))
  
```

```{r}
# Stratified by sex
baseline %>%
  filter(is.na(alc) == FALSE, is.na(sex_risk) == FALSE) %>%
  group_by(sex, alc, sex_risk) %>%
  summarize(count = n()) %>%
  mutate(proportion = round(count / sum(count) * 100, 2)) %>%
  ggplot(aes(x = factor(alc, levels = rev(levels(alc))), 
             y = proportion, fill = sex_risk)) +
  geom_col() +
  geom_text(aes(label = proportion), 
            position = position_stack(vjust = 0.5),
            color = "white") +
  coord_flip() +
  facet_wrap(~ sex) +
  labs(title = "The percentage of risk sexual behavior signigicantly \nincreases if drink alcohol more than one days per month.",
       x = "Frequency of alcohol consumption",
       y = "% of risk sexual behavior") +
  theme_minimal() +
  theme(legend.title=element_blank(),
        legend.position = "bottom",
        plot.title = element_text(hjust = 1))

```






